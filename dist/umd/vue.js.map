{"version":3,"file":"vue.js","sources":["../../myVue/data/array.js","../../myVue/utils/util.js","../../myVue/myVue.js"],"sourcesContent":["let oldArrayProtoMethods = Array.prototype;\r\nexport let arrayMethods = Object.create(oldArrayProtoMethods);\r\n\r\nlet methods = [\r\n  'push',\r\n  'pop',\r\n  'unshift',\r\n  'shift',\r\n  'splice',\r\n  'reverse',\r\n  'sort'\r\n]\r\n\r\nmethods.forEach(method => {\r\n  arrayMethods[method] = function (...args) {\r\n    const result = oldArrayProtoMethods[method].apply(this, arguments);\r\n    let inserted;\r\n    let ob = this.__ob__;\r\n    switch (methods) {\r\n      case 'push':\r\n        break;\r\n      case 'unshift':\r\n        inserted = args;\r\n        break;\r\n      case 'splice':\r\n        inserted = args.slice(2);\r\n      default:\r\n        break;\r\n    }\r\n    if (inserted) ob.observeArray(inserted);\r\n    return result;\r\n  }\r\n})","function proxy (vm, data, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get () {\r\n      return vm[data][key];\r\n    },\r\n    set (newValue) {\r\n      vm[data][key] = newValue;\r\n    }\r\n  })\r\n}\r\n\r\nfunction defineProperty (target, key, value) {\r\n  Object.defineProperty(target, key, {\r\n    enumerable: false, // 不能被枚举\r\n    configurable: false,\r\n    value: value\r\n  })\r\n}\r\n\r\nexport {\r\n  proxy,\r\n  defineProperty\r\n}","import { arrayMethods } from \"./data/array\";\r\nimport { defineProperty, proxy } from \"./utils/util\";\r\n\r\nlet Vue = function (options) {\r\n  this._init(options)\r\n}\r\n\r\nVue.prototype._init = function (options) {\r\n  let vm = this;\r\n  vm.$options = options;\r\n  initState(vm);\r\n}\r\n\r\nconst initState = function initState (vm) {\r\n  const opts = vm.$options;\r\n  if (opts.props) {\r\n    initProps(vm);\r\n  }\r\n  if (opts.methods) {\r\n    initMethods(vm);\r\n  }\r\n  if (opts.data) {\r\n    initData(vm);\r\n  }\r\n}\r\n\r\nfunction initProps (vm) {\r\n\r\n}\r\n\r\nfunction initMethods (vm) {\r\n\r\n}\r\n\r\nfunction initData (vm) {\r\n  let data = vm.$options.data;\r\n  vm._data = data = typeof data === 'function' ? data.call(vm) : data;\r\n  for (let key in data) {\r\n    proxy(vm, '_data', key);\r\n  }\r\n  observe(data);\r\n}\r\n\r\nclass Observe {\r\n  constructor(value) {\r\n    // 判断一个对象是否被检测过\r\n    defineProperty(value, '__ob__', this)\r\n    if (Array.isArray(value)) {\r\n      // 我希望调用 push shift unshift splice sort reverse pop\r\n      value.__proto__ = arrayMethods;\r\n      // 观测\r\n      this.observeArray(value);\r\n    } else {\r\n      this.walk(value);\r\n    }\r\n  }\r\n  walk (data) {\r\n    let keys = Object.keys(data);\r\n    keys.forEach(key => {\r\n      defineReactive(data, key, data[key]);\r\n    })\r\n  }\r\n  observeArray (value) {\r\n    value.forEach(item => {\r\n      observe(item);\r\n    })\r\n  }\r\n}\r\n\r\nfunction defineReactive (data, key, value) {\r\n  observe(value);\r\n  Object.defineProperty(data, key, {\r\n    get () {\r\n      console.log('用户获取值了')\r\n      return value;\r\n    },\r\n    set (newValue) {\r\n      console.log('用户设置值了');\r\n      if (newValue === value) return;\r\n      observe(newValue);\r\n      value = newValue;\r\n    }\r\n  })\r\n}\r\n\r\nfunction observe (data) {\r\n  if (typeof data !== 'object' || data == null) return;\r\n  if (data.__ob__) {\r\n    return;\r\n  }\r\n  return new Observe(data)\r\n}\r\n\r\nexport default Vue;"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","result","apply","arguments","inserted","ob","__ob__","slice","observeArray","proxy","vm","data","key","defineProperty","get","set","newValue","target","value","enumerable","configurable","Vue","options","_init","$options","initState","opts","props","initData","_data","call","observe","Observe","isArray","__proto__","walk","keys","defineReactive","item","console","log"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA,IAAIA,oBAAoB,GAAGC,KAAK,CAACC,SAAjC;EACO,IAAIC,YAAY,GAAGC,MAAM,CAACC,MAAP,CAAcL,oBAAd,CAAnB;EAEP,IAAIM,OAAO,GAAG,CACZ,MADY,EAEZ,KAFY,EAGZ,SAHY,EAIZ,OAJY,EAKZ,QALY,EAMZ,SANY,EAOZ,MAPY,CAAd;EAUAA,OAAO,CAACC,OAAR,CAAgB,UAAAC,MAAM,EAAI;EACxBL,EAAAA,YAAY,CAACK,MAAD,CAAZ,GAAuB,YAAmB;EAAA,sCAANC,IAAM;EAANA,MAAAA,IAAM;EAAA;;EACxC,QAAMC,MAAM,GAAGV,oBAAoB,CAACQ,MAAD,CAApB,CAA6BG,KAA7B,CAAmC,IAAnC,EAAyCC,SAAzC,CAAf;EACA,QAAIC,QAAJ;EACA,QAAIC,EAAE,GAAG,KAAKC,MAAd;;EACA,YAAQT,OAAR;EACE,WAAK,MAAL;EACE;;EACF,WAAK,SAAL;EACEO,QAAAA,QAAQ,GAAGJ,IAAX;EACA;;EACF,WAAK,QAAL;EACEI,QAAAA,QAAQ,GAAGJ,IAAI,CAACO,KAAL,CAAW,CAAX,CAAX;EAPJ;;EAWA,QAAIH,QAAJ,EAAcC,EAAE,CAACG,YAAH,CAAgBJ,QAAhB;EACd,WAAOH,MAAP;EACD,GAjBD;EAkBD,CAnBD;;ECbA,SAASQ,KAAT,CAAgBC,EAAhB,EAAoBC,IAApB,EAA0BC,GAA1B,EAA+B;EAC7BjB,EAAAA,MAAM,CAACkB,cAAP,CAAsBH,EAAtB,EAA0BE,GAA1B,EAA+B;EAC7BE,IAAAA,GAD6B,iBACtB;EACL,aAAOJ,EAAE,CAACC,IAAD,CAAF,CAASC,GAAT,CAAP;EACD,KAH4B;EAI7BG,IAAAA,GAJ6B,eAIxBC,QAJwB,EAId;EACbN,MAAAA,EAAE,CAACC,IAAD,CAAF,CAASC,GAAT,IAAgBI,QAAhB;EACD;EAN4B,GAA/B;EAQD;;EAED,SAASH,cAAT,CAAyBI,MAAzB,EAAiCL,GAAjC,EAAsCM,KAAtC,EAA6C;EAC3CvB,EAAAA,MAAM,CAACkB,cAAP,CAAsBI,MAAtB,EAA8BL,GAA9B,EAAmC;EACjCO,IAAAA,UAAU,EAAE,KADqB;EACd;EACnBC,IAAAA,YAAY,EAAE,KAFmB;EAGjCF,IAAAA,KAAK,EAAEA;EAH0B,GAAnC;EAKD;;MCdGG,GAAG,GAAG,SAANA,GAAM,CAAUC,OAAV,EAAmB;EAC3B,OAAKC,KAAL,CAAWD,OAAX;EACD;;EAEDD,GAAG,CAAC5B,SAAJ,CAAc8B,KAAd,GAAsB,UAAUD,OAAV,EAAmB;EACvC,MAAIZ,EAAE,GAAG,IAAT;EACAA,EAAAA,EAAE,CAACc,QAAH,GAAcF,OAAd;EACAG,EAAAA,SAAS,CAACf,EAAD,CAAT;EACD,CAJD;;EAMA,IAAMe,SAAS,GAAG,SAASA,SAAT,CAAoBf,EAApB,EAAwB;EACxC,MAAMgB,IAAI,GAAGhB,EAAE,CAACc,QAAhB;;EACA,MAAIE,IAAI,CAACC,KAAT,EAAgB;;EAGhB,MAAID,IAAI,CAAC7B,OAAT,EAAkB;;EAGlB,MAAI6B,IAAI,CAACf,IAAT,EAAe;EACbiB,IAAAA,QAAQ,CAAClB,EAAD,CAAR;EACD;EACF,CAXD;;EAqBA,SAASkB,QAAT,CAAmBlB,EAAnB,EAAuB;EACrB,MAAIC,IAAI,GAAGD,EAAE,CAACc,QAAH,CAAYb,IAAvB;EACAD,EAAAA,EAAE,CAACmB,KAAH,GAAWlB,IAAI,GAAG,OAAOA,IAAP,KAAgB,UAAhB,GAA6BA,IAAI,CAACmB,IAAL,CAAUpB,EAAV,CAA7B,GAA6CC,IAA/D;;EACA,OAAK,IAAIC,GAAT,IAAgBD,IAAhB,EAAsB;EACpBF,IAAAA,KAAK,CAACC,EAAD,EAAK,OAAL,EAAcE,GAAd,CAAL;EACD;;EACDmB,EAAAA,OAAO,CAACpB,IAAD,CAAP;EACD;;MAEKqB;EACJ,mBAAYd,KAAZ,EAAmB;EAAA;;EACjB;EACAL,IAAAA,cAAc,CAACK,KAAD,EAAQ,QAAR,EAAkB,IAAlB,CAAd;;EACA,QAAI1B,KAAK,CAACyC,OAAN,CAAcf,KAAd,CAAJ,EAA0B;EACxB;EACAA,MAAAA,KAAK,CAACgB,SAAN,GAAkBxC,YAAlB,CAFwB;;EAIxB,WAAKc,YAAL,CAAkBU,KAAlB;EACD,KALD,MAKO;EACL,WAAKiB,IAAL,CAAUjB,KAAV;EACD;EACF;;;;2BACKP,MAAM;EACV,UAAIyB,IAAI,GAAGzC,MAAM,CAACyC,IAAP,CAAYzB,IAAZ,CAAX;EACAyB,MAAAA,IAAI,CAACtC,OAAL,CAAa,UAAAc,GAAG,EAAI;EAClByB,QAAAA,cAAc,CAAC1B,IAAD,EAAOC,GAAP,EAAYD,IAAI,CAACC,GAAD,CAAhB,CAAd;EACD,OAFD;EAGD;;;mCACaM,OAAO;EACnBA,MAAAA,KAAK,CAACpB,OAAN,CAAc,UAAAwC,IAAI,EAAI;EACpBP,QAAAA,OAAO,CAACO,IAAD,CAAP;EACD,OAFD;EAGD;;;;;;EAGH,SAASD,cAAT,CAAyB1B,IAAzB,EAA+BC,GAA/B,EAAoCM,KAApC,EAA2C;EACzCa,EAAAA,OAAO,CAACb,KAAD,CAAP;EACAvB,EAAAA,MAAM,CAACkB,cAAP,CAAsBF,IAAtB,EAA4BC,GAA5B,EAAiC;EAC/BE,IAAAA,GAD+B,iBACxB;EACLyB,MAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;EACA,aAAOtB,KAAP;EACD,KAJ8B;EAK/BH,IAAAA,GAL+B,eAK1BC,QAL0B,EAKhB;EACbuB,MAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;EACA,UAAIxB,QAAQ,KAAKE,KAAjB,EAAwB;EACxBa,MAAAA,OAAO,CAACf,QAAD,CAAP;EACAE,MAAAA,KAAK,GAAGF,QAAR;EACD;EAV8B,GAAjC;EAYD;;EAED,SAASe,OAAT,CAAkBpB,IAAlB,EAAwB;EACtB,MAAI,QAAOA,IAAP,MAAgB,QAAhB,IAA4BA,IAAI,IAAI,IAAxC,EAA8C;;EAC9C,MAAIA,IAAI,CAACL,MAAT,EAAiB;EACf;EACD;;EACD,SAAO,IAAI0B,OAAJ,CAAYrB,IAAZ,CAAP;EACD;;;;;;;;"}