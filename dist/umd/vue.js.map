{"version":3,"file":"vue.js","sources":["../../myVue/data/array.js","../../myVue/myVue.js"],"sourcesContent":["let oldArrayProtoMethods = Array.prototype;\r\nexport let arrayMethods = Object.create(oldArrayProtoMethods);\r\n\r\nlet methods = [\r\n  'push',\r\n  'pop',\r\n  'unshift',\r\n  'shift',\r\n  'splice',\r\n  'reverse',\r\n  'sort'\r\n]\r\n\r\nmethods.forEach(method => {\r\n  arrayMethods[method] = function (...args) {\r\n    const result = oldArrayProtoMethods[method].apply(this, arguments);\r\n    let inserted;\r\n    let ob = this.__ob__;\r\n    switch (methods) {\r\n      case 'push':\r\n        break;\r\n      case 'unshift':\r\n        inserted = args;\r\n        break;\r\n      case 'splice':\r\n        inserted = args.slice(2);\r\n      default:\r\n        break;\r\n    }\r\n    if (inserted) ob.observeArray(inserted);\r\n    return result;\r\n  }\r\n})","import { arrayMethods } from \"./data/array\";\r\n\r\nlet Vue = function (options) {\r\n  this._init(options)\r\n}\r\n\r\nVue.prototype._init = function (options) {\r\n  let vm = this;\r\n  vm.$options = options;\r\n  initState(vm);\r\n}\r\n\r\nconst initState = function initState (vm) {\r\n  const opts = vm.$options;\r\n  if (opts.props) {\r\n    initProps(vm);\r\n  }\r\n  if (opts.methods) {\r\n    initMethods(vm);\r\n  }\r\n  if (opts.data) {\r\n    initData(vm);\r\n  }\r\n}\r\n\r\nfunction initProps (vm) {\r\n\r\n}\r\n\r\nfunction initMethods (vm) {\r\n\r\n}\r\n\r\nfunction initData (vm) {\r\n  let data = vm.$options.data;\r\n  vm._data = data = typeof data === 'function' ? data.call(vm) : data;\r\n  observe(data);\r\n}\r\n\r\nclass Observe {\r\n  constructor(value) {\r\n    // 判断一个对象是否被检测过\r\n    Object.defineProperty(value, '__ob__', {\r\n      enumerable: false, // 不能被枚举\r\n      configurable: false,\r\n      value: this\r\n    })\r\n    if (Array.isArray(value)) {\r\n      // 我希望调用 push shift unshift splice sort reverse pop\r\n      value.__proto__ = arrayMethods;\r\n      // 观测\r\n      this.observeArray(value);\r\n    } else {\r\n      this.walk(value);\r\n    }\r\n  }\r\n  walk (data) {\r\n    let keys = Object.keys(data);\r\n    keys.forEach(key => {\r\n      defineReactive(data, key, data[key]);\r\n    })\r\n  }\r\n  observeArray (value) {\r\n    value.forEach(item => {\r\n      observe(item);\r\n    })\r\n  }\r\n}\r\n\r\nfunction defineReactive (data, key, value) {\r\n  observe(value);\r\n  Object.defineProperty(data, key, {\r\n    get () {\r\n      console.log('用户获取值了')\r\n      return value;\r\n    },\r\n    set (newValue) {\r\n      console.log('用户设置值了');\r\n      if (newValue === value) return;\r\n      observe(newValue);\r\n      value = newValue;\r\n    }\r\n  })\r\n}\r\n\r\nfunction observe (data) {\r\n  if (typeof data !== 'object' || data == null) return;\r\n  if (data.__ob__) {\r\n    return;\r\n  }\r\n  return new Observe(data)\r\n}\r\n\r\nexport default Vue;"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","result","apply","arguments","inserted","ob","__ob__","slice","observeArray","Vue","options","_init","vm","$options","initState","opts","props","data","initData","_data","call","observe","Observe","value","defineProperty","enumerable","configurable","isArray","__proto__","walk","keys","key","defineReactive","item","get","console","log","set","newValue"],"mappings":"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"}